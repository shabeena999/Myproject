<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <link rel="icon" href="https://www.shutterstock.com/image-vector/map-pointer-car-icon-vector-600w-133330619.jpg" type="image/jpg">
  <title>Voyage</title>

</head>

<body>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
  <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
  <link href="/css/rentnow.css" rel="stylesheet" type="text/css" />
  <script defer src="/rentnow.js"></script>
  <!------ Include the above in your HEAD tag ---------->

  <!-- 
    Info: Booking Form
    Description: Brand new customer adds a car / new car to their account.
    ==== Credit ==== 
    Forked from Andi: http://codepen.io/andiio/pen/tFECp
    font: Lato (google font)
    Icon font:   http://fontawesome.io/icons/

================================= -->
  <form id="paymentForm" >
    <!--  General -->
    <div class="form-group">
      <center>
        <h1><u class="thick" style="font-family: Blackadder ITC; font-size:4em;">Rent Now</u></h1>
      </center>
      <br />
      <br />
      <br />
      <h2 class="heading">Owner Details</h2>
      <div class="controls">
        <input type="text" id="name" placeholder="Name" lass="floatLabel" name="name">
      </div>
      <div class="controls">
        <input type="text" id="email" placeholder="Email" class="floatLabel" name="email" readonly>
        <!-- <label for="email">Email</label> -->
      </div>
      <div class="controls">
        <input type="tel" id="phone" placeholder="Phone" class="floatLabel" name="phone" readonly>
        <!-- <label for="phone">Phone</label> -->
      </div>
      <div class="grid">
        <div class="col-2-3">
          <div class="controls">
            <input type="text" id="street" placeholder="Street" class="floatLabel" name="street">
            <!-- <label for="street">Street</label> -->
          </div>
        </div>
        <div class="col-1-3">
          <div class="controls">
            <input type="number" id="street-number" placeholder="Street Number" class="floatLabel" name="street-number">
            <!-- <label for="street-number">House No.</label> -->
          </div>
        </div>
      </div>
      <div class="grid">
        <div class="col-2-3">
          <div class="controls">
            <input type="text" id="city" placeholder="City" class="floatLabel" name="city">
            <!-- <label for="city">City</label> -->
          </div>
        </div>
        <div class="col-1-3">
          <div class="controls">
            <input type="text" id="post-code" placeholder="Post-Code" class="floatLabel" name="post-code">
            <!-- <label for="post-code">Post Code</label>  -->
          </div>
        </div>
      </div>
      <div class="controls">
        <input type="text" id="country" placeholder="Country" class="floatLabel" name="country">
        <!-- <label for="country">Country</label> -->
      </div>
    </div>
    <!--  Car Details -->
    <div class="form-group">
      <h2 class="heading">Documents </h2>

      <div class="grid">
        <div class="hide-cont">
          <!--Start Grid-->
          <div class="radio-cont" style="padding-left:40px;padding-top:11px;">
            <br>
            <label>
              <input type="radio" name="textbox" value="show" onchange="showTextBox()"><span style="color:white;"> With
                Driver</span>
            </label>
            &nbsp;&nbsp;&nbsp;&nbsp;
            <label>
              <input type="radio" name="textbox" value="hide" onchange="hideTextBox()"> <span style="color:white;">
                Without Driver</span>
            </label>
          </div>
          <!-- </div> -->
          <div class="col-1-3">
            <div class="controls" style="padding-left:58px;">
              <input type="text" id="regno" class="floatLabel" placeholder="License Number" name="carmodel"
                style=" display:none;width:400px;height:45px;">
          </div>
        </div>
      </div>
      <!--End Grid-->
      <br>

      <div class="grid">
        <!--Start Grid-->
        <div class="col-1-3" style="width:320px;">
          <div class="controls" style="width:320px;">
            <input type="text" id="aadhar" placeholder="Aadhar Number" class="floatLabel" name="aadhar"
              pattern="\d{4}-\d{4}-\d{4}" maxlength="19" >
            <!-- <label for="carmodel">Car Model</label> -->
          </div>
        </div>

        <div class="col-1-3" style="padding-left:25px;width:370px;">
          <div class="controls">
            <div class="file-cont">
              <input type="file" id="upload-file" class="floatLabel" name="something">
              <!-- <label for="file-upload">Upload file</label> -->
            </div>
            <!-- <label for="something">Something</label> -->
          </div>
        </div>
      </div>
      <!--End Grid-->
      <br>
      <div class="grid">
        <!--Start Grid-->
        <div class="col-1-3" style="width:320px;">
          <div class="controls" style="width:320px;">
            <input type="text" id="pancard" placeholder="PAN NUMBER" class="floatLabel" name="aadhar" >
            <!-- <label for="carmodel">Car Model</label> -->
          </div>
        </div>

        <div class="col-1-3" style="padding-left:25px;">
          <div class="controls">
            <div class="file-cont">
              <input type="file" id="upload-file" class="floatLabel" name="something">
            </div>
            <!-- <label for="something">Something</label> -->
          </div>
        </div>
      </div>

    </div>
    </div>
    </div> <!-- /.form-group -->

    <!-- payment details -->

    <form action="payscript.php" method="post">
    <div class="form-group">
      <h2 class="heading">Payment </h2>
      <div class="container">
        <div class="img-container">
          <div class="v-name">
            <h2 id = "vname"> Vehicle-name </h2>
          </div>
          <div class="v-img">
            <img id = "vimage"
              src="https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MTB8fGNhcnN8ZW58MHx8MHx8&w=1000&q=80">
          </div>
        </div>
        <div class="data-container">
          <div class="date-container">
            <div class="pickup-date-container">
              <label for="pickup-date">Pickup Date</label>
              <input type="date" id="pickup-date" name="bookDateTime" placeholder="Book Date-Time">
            </div>

            <div class="pickup-date-container">
              <label for="drop-date">Drop Date</label>
              <input type="date" id="drop-date" name="dropDateTime" placeholder="Drop Date-Time">
            </div>
          </div>
          <div class="days-count" style="justify-content: center;">
            <label for="count">Number of Days</label>&emsp;&emsp;&emsp;
            <input type="text" id="count" name="count" placeholder="days" readonly>
          </div>
          <div class="price" style="justify-content: center;">
            <label for="v-price">Price per Day</label>&emsp;&emsp;&emsp;&emsp;&nbsp;
            <input type="text" id="v-price" placeholder="Price" readonly>
          </div>
          <div class="total" style="justify-content: center;">
            <label for="total">Total Cost</label>&emsp;&emsp;&emsp;&emsp;&emsp;&nbsp;&nbsp;&nbsp;
            <input type="text" id="result" placeholder="Total Cost" readonly>
          </div>

        </div>
      </div>

    </div>
    <div class="wrap">
      <button class="btn" type="submit" >Pay Now</button>
      <!-- <button class="button1" type="submit">Login</button> -->
    </div>
    </form>
    </div>
    </div> <!-- /.form-group -->
  </form>
</body>

<script>
  function getCurrentURL() {
        return window.location.href;
      }

      // Example
      // const url = getCurrentURL();
      // console.log(url.substring(url.lastIndexOf("/") + 1));
      // let vehicleId = url.substring(url.lastIndexOf("/") + 1);

      let orderId;
      let orderDb;
      let price =document.getElementById('v-price');
      let result =document.getElementById('result');
      let vimage = document.getElementById('vimage');
      let vname = document.getElementById('vname');
      let email = document.getElementById('email');
      let phone = document.getElementById('phone');
      let name = document.getElementById('name');
      let street = document.getElementById('street');
      let streetNumber = document.getElementById('street-number');
      let postCode = document.getElementById('post-code');
      let country = document.getElementById('country');
      let aadhar = document.getElementById('aadhar');
      let pancard = document.getElementById('pancard');
      let count = document.getElementById('count');
      let pickUp = document.getElementById('pickup-date');
      let drop = document.getElementById('drop-date');

      let paymentForm = document.getElementById('paymentForm');
      window.onload = async () => {
        const url = getCurrentURL();
        let vehicleId = url.substring(url.lastIndexOf("/") + 1);

        // let data = await fetch(`http://localhost:3001/getDetails/${vehicleId}`);
        let data = await fetch(`/getDetails/${vehicleId}`);
        data = await data.json();
        console.log(data)

        price.value = data.vehicleData.Price;

        vimage.src = data.vehicleData.images[0];

        vname.textContent = data.vehicleData.Name;

        email.value = data.userData.username;
        
        phone.value = data.userData.Mobile;
        let userData = data.userData;

        let options;
        console.log(userData.username)
        if(userData.Name){
          name.value = userData.Name;
          street.value = userData.Address.Street;
          streetNumber.value =userData.Address.StreetNumber;
          city.value= userData.Address.City;
          postCode.value= userData.Address.PostCode;
          country.value= userData.Address.Country;
          aadhar.value = userData.Aadhar;
          pancard.value = userData.Pan;
        }
        // else {
        //   console.log("Name does not exist")
        // } 
      }

      paymentForm.addEventListener("submit", function (e) {
      e.preventDefault();
      // // var pass = document.getElementById("psw").value;
      
      // var email = document.getElementById("email").value;

      if(name.value === "" || count == ""){
        alert("Fill all the details");
        return;
      }

    options = {
        key: "rzp_test_dZdMvAObQuNOs7", // Enter the Key ID generated from the Dashboard
        amount: parseInt(result.value)*100, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
        currency: "INR",
        name: "Voyage Ltd",
        description: "Test Transaction",
        image: "https://example.com/your_logo",
        order_id: orderId, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
        // callback_url: `http://16.16.159.99:3001/success.html`,
        callback_url: `/success.html`,
        prefill: {
          name: name.value,
          email: email.value,
          contact: phone.value,
        },
        notes: {
          address: "Moahali",
        },
        theme: {
          color: "#3399cc",
        },
      };

      $.ajax({
        type: "POST",
        // url: "http://localhost:3001/createOrder",
        url: "/createOrder",
        dataType: "json",
        data: { Name: name.value, Street: street.value, StreetNumber : streetNumber.value, City : city.value, PostCode : postCode.value, Country: country.value, Aadhar : aadhar.value, Pan: pancard.value, Cost:result.value, pickUp:pickUp.value, drop:drop.value, vehicleId  : window.location.href.substring(window.location.href.lastIndexOf("/") + 1)},
        success: function (data) {
          console.log(data);
          orderId = data.order.id;
          orderDb = data.orderDb._id;
          // options.callback_url = `http://localhost:3001/updateOrderStatus/${orderDb}`;
          options.callback_url = `/updateOrderStatus/${orderDb}`;
          console.log(options.callback_url);
          var rzp1 = new Razorpay(options);
          // openRazorPay(orderId);
          
          console.log((parseInt(result.value)*100))
          // options.amount = parseInt(result.value)*100;
          rzp1.open();


          // if (data.message === "Success") {
          //   alert("Signed In")
          //   window.location = document.referrer;
          // //   window.location = "./signin.html";
          // } else {
          //   alert("Login Failed, Please try again");
          // }
        },
      });
      console.log("agasdg");
    });
</script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  
  // var rzp1 = new Razorpay(options);
  // document.getElementById("paymentForm").onclick = function (e) {
    function openRazorPay(order) {
      console.log((parseInt(result.value)*100))
      options.amount = parseInt(result.value)*100;
      rzp1.open();
    // e.preventDefault();
  };
</script>
</html>